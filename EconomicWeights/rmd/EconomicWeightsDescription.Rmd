---
title: "EconomicWeightsDescription"
author: "Silvan"
date: "5 10 2018"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Purpose

To show how economic weights have been computed for carcass fat (CF), carcass conformation (CC) and carcass weight (CW).

# Principle

For each trait: CF, CC, CW.
To present the current beef population as normal distribution over the trait.
Then to shift the normal distribution by increasing the mean by a tiny positive value.
Scale on the whole unit of the trait, result is a value with unit **Sfr. / trait unit**.

# Material

* "EconomicWeights" File

# Implementation

Economic weights are weighing factors to produce an aggregate genotype $H$

$$H=\sum{a_iu_i}$$

where

$a$ is an economic weight,

$u$ is a true breeding value and

$i$ is a trait.

In this thesis the aggregate genotype consists of the traits carcass fat, carcass conformation and carcass weight.
Consequently the three traits need an economical weight each.
The economical weight for a trait is the change in profit (Sfr.) per additional unit of the trait.
It is given by the equation

$$a=\frac{\Delta_p}{\Delta_{\mu}}$$

where

$a$ is the economic value of a trait,

$\Delta$ indicates a difference in the underscore variable,

$p$ is the profit in Sfr and

$\mu$ is the population mean in unit of a trait.

However, there is no information available about the true change in profit per unit carcass fat, carcass conformation and carcass weight.
This change is therefore approximated by only using the difference in revenue which is caused by price differences per kg carcass weight in the slaughterhouse.
These price differences per unit of a carcass trait are based on CHTAX. 
There the price differences do not have the same value over the whole scale of the carcass traits.
For example the change in revenue from carcass fat class 1 to 2 is not the same as from 2 to 3.
Consequently, the economic weight depends on the initial distribution of the population over the scale of a carcass trait.
Here the distribution is approximated to a normal distribution using the mean and the standard deviation of a carcass trait in the population.





are different for "adults" and "calves" (See Table ??).




## Carcass fat
The trait carcass fat has the unit carcass fat class (see table???).
Therefore the economical weight for carcass fat is the additional profit per unit of carcass fat class.
I choose the unit Swiss Francs (Sfr.) per 0.1 carcass fat class for the economic value of carcass fat ($\Delta_{\mu} = 0.1$).

$\Delta_p$ in turn is

$$\Delta_p=r_1^Tp-r_0^Tp$$

$r$ is the vector of population shares belonging to each carcass fat class.

$p$ is the vector of price change per kg for each carcass fat class (see table )

$T$ means, it is the transpose.

$0$ indicates the initial population.

$1$ indicates the population after the change in population mean of 0.1.


I know the initial distribution $r_0$ of the population over the carcass fat scores from the data of Qualitas AG.
The distribution is discrete, which means I know the share of the population within each carcass fat class (see figure \@ref(fig:InitialSharesCF_barplot)).

```{r InitialSharesCF_barplot, echo=FALSE, fig.cap="Population shares for each carcass fat class in Angus and Limousin calves and stirks (Kunz, 2018)"}
library(knitr)
library(kableExtra)
#Vectors of animal numbers Carcass fat 
#Angus with a=stirks and c=calves.
Ancfc <- c(189,706,935,125,2)
Ancfa <- c(802,3415,15673,6314,481)
#Limousin with a=stirks and c=calves.
Lmcfc <- c(735,1504,1419,72,0)
Lmcfa <- c(5102,21958,50705,7169,148)
#Shares Carcass fat
#Angus with a=stirks and c=calves.
Ancfc <- Ancfc/sum(Ancfc)
Ancfa <- Ancfa/sum(Ancfa)
#Limousin with a=stirks and c=calves.
Lmcfc <- Lmcfc/sum(Lmcfc)
Lmcfa <- Lmcfa/sum(Lmcfa)

#Values Carcass fat classes
Vcf <- c(1:5)

#define number of rows
#x <- cbind(Vcf,Ancfc,Ancfa,Lmcfc,Lmcfa)
#colnames(x) <- c("class", "ANcalves", "ANstirks", "LMcalves", "LMstirks")
#kable(x, booktabs=T, caption="Population shares for each carcass fat class in Angus and Limousin calves and stirks (Kunz, 2018)")
#x <- as.data.frame(x)
# settings barplot
library(ggplot2)
theme_set(theme_classic())
#set dataframe
x <-data.frame(Class=rep(c(1:5),times=2*2),Category=rep(c("AN", "LM"),each=10), Share=c(Ancfc,Ancfa,Lmcfc,Lmcfa))
x$Group <- rep(rep(c("Calves","Adults"),each=5),times=2)
# Plot
g <- ggplot(x,aes(Class,Share))
g +facet_grid(~Group) + geom_bar(stat="identity", width=0.5, aes(fill=Category), position="dodge")+
  theme_classic()
```

The price change $p$ for calves comes from the pricing system CHTAX for the slaughter category KV and the one from stirks is the mean of the slaughter categories MT, OB and RG (see table \@ref(tab:PriceCF)).


```{r IntitialFreq_cf_Table}
#define number of rows
x <- cbind(Vcf,Ancfc,Ancfa,Lmcfc,Lmcfa)
colnames(x) <- c("class", "ANcalves", "ANstirks", "LMcalves", "LMstirks")
kable(x, booktabs=T, caption="Population shares for each carcass fat class in Angus and Limousin calves and stirks (Kunz, 2018)", digits =3)
```

```{r Price_cf, echo=F}
# Mean price minus stirks / kg carcass weight
# mean price plus or minus for different carcass fat classes from Proviande 2018, week 33.
library(knitr)
z<-data.frame(class=c("1","2","3","4","5"))
x<-data.frame(MT=c(-0.9,-0.3,0,-0.3,-0.7), 
              OB=c(-0.9, -0.3,0,-0.4,-0.9), RG=c(-0.9,-0.3,0,-0.5,-1))
y<-as.matrix(x)
#compute mean over categories
x$mean<-rowMeans(y)
x<-cbind(z,x) 
#defintion of variable
cfap <- x$mean
#Mean price minus calves / kg carcass weight
cfcp <- c(-1.5,-0.6,0,-0.4,1)
x<-cbind(z,cfap,cfcp)
colnames(x) <- c("class", "stirks","calves")
kable(x, digits=1, caption="Price change in Sfr. per kg carcass weight for each carcass fat class in stirks and calves (Proviande, 2018).")
```
@Proviande2018

$r_1$ could be computed in shifting the distribution until the mean increased by 0.1.
Changing the mean is difficult without changing the distribution shape for a discrete distribution.
Therefore I will use the assumption that carcass fat class is normally distributed in the population.
Then I approximate the normal distribution to the discrete distribution (see figure??)

```{r NormDistApprox, fig.cap="Approximation of normal distribution to discrete distribution."}
library(ggplot2)
AncfaS <- 0.74
AncfaM <- 3.1
x <- data.frame(Class=Vcf,Share=Ancfa)
g <- ggplot(x,aes(Class,Share))
g + geom_bar(stat="identity", width=0.5, fill="tomato2") +
  stat_function(fun = dnorm, args = list(mean = AncfaM, sd = AncfaS))+
  theme_classic()
```


However the borders of the normal distribution are not clear.
For example, should you set the thresholds of class 1 at 0.5 and 1.5 or at 0 and 1?
I used a trick to get the thresholds of the normal distribution.
I knew the shares of the initial population and derived from the shares, which thresholds would be necessary in a normal distribution to get the right shares per class.

I got the thresholds of the initial distribution by the R-command `qnorm()`. 
This command gave me the quantil of the area under the normal distribution.
The area is the share of animals which belong to specific carcass fat classes.

Afterwards I need to get the shares of the normal distribution after the change of mean (see figure ??).

```{r ShiftMean, fig.cap="Initial and new distribution"}
library(ggplot2)
x <- data.frame(Class=Vcf,Share=Ancfa)
g <- ggplot(x,aes(Class,Share,linetype="Mean"))
g + stat_function(fun = dnorm, args = list(mean = AncfaM, sd = AncfaS), aes(linetype="Initial distribution"))+
  stat_function(fun = dnorm, args = list(mean = AncfaM+0.1, sd = AncfaS),aes(linetype="New distribution"))+
    scale_linetype_manual(values=c("solid","dashed"), guide = guide_legend(title=NULL))+
  theme_classic()
  
```


I used the command `pnorm()` using the values of the t to get back the shares, which is $r_1$.








