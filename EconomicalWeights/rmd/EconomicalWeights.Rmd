---
title: "EconomicalWeigths"
author: "Silvan"
date: "2 10 2018"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(tidy = TRUE)
```

## Economical Weights

Economical weights are factors to produce an aggregate genotype from multiple traits.
There is one economical weight per involved trait.
The economical weight per trait is the change in profit (Sfr.) per additional unit of the trait.
Here the aggregate genotype consists of the traits carcass fat, carcass conformation and carcass weight.
Consequently the three traits need an economical weight each.
Also aggregate genotypes have to be computed for each breed and animal group separateley.
As an example the economic values will appear for the most distinct breeds, Angus and Limousin and the group stirks.

### Carcass fat
The trait carcass fat has the unit carcass fat class (see table???).
Therefore the economical weight for carcass fat is the additional revenue per unit of carcass fat class.
I choose the unit Swiss Francs (Sfr.) per 1 carcass fat class.

#### Model
To get the minus of Sfr. per 1 carcass fat class, I need to calculate the mean price difference in a population when I change the mean carcass fat score in the population.
To do so I change the population slightly, but try to conserve the intial distribution shape.
The change should predict the possible change when breeding.

I know the initial distribution of the population over the carcass fat scores from the data of Qualitas AG.
The distribution is discrete, which means I know the share of the population within each carcass fat class.
Changing the mean is difficult without changing the distribution shape for a discrete distribution.

```{r DiscreteInitialCarcassFat}
#Vectors of animal numbers Carcass fat 
#Angus with a=stirks and c=calves.
Ancfc <- c(189,706,935,125,2)
Ancfa <- c(802,3415,15673,6314,481)
#Limousin with a=stirks and c=calves.
Lmcfc <- c(735,1504,1419,72,0)
Lmcfa <- c(5102,21958,50705,7169,148)

#Shares Carcass fat
#Angus with a=stirks and c=calves.
Ancfc <- c(189,706,935,125,2)/sum(Ancfc)
Ancfa <- c(802,3415,15673,6314,481)/sum(Ancfa)
#Limousin with a=stirks and c=calves.
Lmcfc <- c(735,1504,1419,72,0)/sum(Lmcfc)
Lmcfa <- c(5102,21958,50705,7169,148)/sum(Lmcfa)

#Values Carcass fat classes
Vcf <- c(1,2,3,4,5)

#Means (M)
#Angus
AncfcM <- sum(Vcf*Ancfc)
AncfaM <- sum(Vcf*Ancfa)
#Limousin
LmcfcM <- sum(Vcf*Lmcfc)
LmcfaM <- sum(Vcf*Lmcfa)

#Standard deviations (S)
#Angus
AncfcS <- stdev(Vcf*Ancfc)
AncfaS <- stdev(Vcf*Ancfa)
#Limousin
LmcfcM <- stdev(Vcf*Lmcfc)
LmcfaM <- stdev(Vcf*Lmcfa)

#New means (M2)
#Angus
AncfcM2 <- 
AncfaM2 <- 
#Limousin
LmcfcM2 <- 
LmcfaM2 <- 


# scores (phenotypic) in Limousin and Angus.
#shares of carcasses in the different fat scores
library(knitr)
x1<-data.frame(class=c(1,2,3,4,5),
               Angus=c(0.030, 0.125, 0.580, 0.240, 0.025), 
  Limousin=c(0.05, 0.26, 0.60, 0.09, 0.00))
#old means
(meanAng1 <- sum(x1$Angus1*x1$class))
(meanLim1 <- sum(x1$Limousin1*x1$class))
#how much i take of 1 and 2 and how much I put to 4 and 5 (d)
d<-0.01
#new shares after transformation
x2<-data.frame(class=c(1,2,3,4,5),
               
               Angus2=c(0.030, 0.125+0.5*d, 0.580+1.5*d, 0.240-1.5*d, 0.025-0.5*d),
               Limousin2=c(0.05-0.5*d, 0.26-1.5*d, 0.60+1.5*d, 0.09+0.5*d, 0.00))
#new means
(meanAng2 <- sum(x2$Angus2*x2$class))
(meanLim2 <- sum(x2$Limousin2*x2$class))
plot(x1$Angus1)
plot(x2$Angus2)
```

Changing the mean is difficult without changing the distribution shape for a discrete distribution.

This will be the first scenario.
The second scenario is that I shift the deviation to the right, so that the mean will be a little above the mean of the first scenario.
Then I just need to subtract the mean revenue from the first scenario from the mean revenue of the second scenario.
The mean revenue is determined by the price plus or minus of a carcass fat class and by how many animals are classified in the specific class.

I know the share of animals in the different carcass fat classes, but I do not know the mean price plus or minus for the different carcass fat classes.
The group "stirks" consists of the carcass categories MT, OB and RG.
Therefore I will take the mean for the price plus or minus of the three carcass categories.
At the moment it will be sufficient to use the price of the week 33 in 2018 (13.8.18).

```{r PriceMeanMinusCarcassFat}
# mean price plus or minus for different carcass fat classes from Proviande 2018, week 33.
library(knitr)
z<-data.frame(class=c("1","2","3","4","5"))
x<-data.frame(MT=c(-0.9,-0.3,0,-0.3,-0.7), 
              OB=c(-0.9, -0.3,0,-0.4,-0.9), RG=c(-0.9,-0.3,0,-0.5,-1))
y<-as.matrix(x)
#compute mean over categories
x$mean<-rowMeans(y)
x<-cbind(z,x) 
kable(x, digits=1)

```

```{r ewdiscrete}
#compute price first scenario for Angus and Limousin
AnPSc1<-t(x$mean)%*%x1$Angus1
LimPSc1<-t(x$mean)%*%x1$Limousin1
#compute price second scenario for Angus and Limousin
AnPSc2<-t(jx$mean)%*%x2$Angus2
LimPSc2<-t(x$mean)%*%x2$Limousin2
#compute difference from second to first scenario
AnDiff<-AnPSc2-AnPSc1
LimDiff<-LimPSc2-LimPSc1
#economical weights in Sfr. per additional score
ewAng<-AnDiff/(meanAng2-meanAng1)
ewAng 
ewLim<-LimDiff/(meanLim2-meanLim1)
ewLim
meanAng2-meanAng1
```

#### Normal distribution
I can do the same but assuming a normal distribution instead of the empiric discrete distribution.
The normal distribution is determined by mean and standard deviation.
```{r NormDistMeanStdv}
#Angus mean
meanAng1
#Limousin mean
meanLim1
#Angus standard deviation
stdvAng<-0.74
#Limousin standard deviation
stdvLim<-0.71
```

Then I take the normal distribution and divide it into different parts.
Each part represents a fat score. 
Afterwards I can compute the mean price in scenario 1 with the first mean.
To do so I multiply each part share of the normal distribution with the attributing price minus.
Then I can do the same with the second mean.
The difference of the two scenarios corrected by the difference of means will result in the economical weight per carcass fat score.

```{r ScenariosNormDist}
#shares scenarios Angus
Ang1<-c(pnorm(1.5, mean=meanAng1, sd=stdvAng, lower.tail = T) -pnorm(0.5, mean=meanAng1, sd=stdvAng,lower.tail = T),
        
        pnorm(2.5, mean=meanAng1, sd=stdvAng,lower.tail = T) -pnorm(1.5, mean=meanAng1 ),
        
        (pnorm(3, mean=meanAng1, sd=stdvAng, lower.tail = T) -pnorm(2.5, mean=meanAng1, sd=stdvAng,lower.tail = T)) + (pnorm(3, mean=meanAng1, sd=stdvAng,lower.tail = F) -pnorm(3.5, mean=meanAng1,sd=stdvAng, lower.tail = F)),
        
        pnorm(3.5, mean=meanAng1, sd=stdvAng, lower.tail = F ) -pnorm(4.5, mean=meanAng1,sd=stdvAng, lower.tail = F ),
        
        pnorm(4.5, mean=meanAng1, sd=stdvAng, lower.tail = F ) -pnorm(5.5, mean=meanAng1 ,sd=stdvAng, lower.tail = F))


Ang2<-c(pnorm(1.5, mean=meanAng2, sd=stdvAng, lower.tail = T) -pnorm(0.5, mean=meanAng2, sd=stdvAng,lower.tail = T),
        
        pnorm(2.5, mean=meanAng2, sd=stdvAng,lower.tail = T) -pnorm(1.5, mean=meanAng2 ),
        
        (pnorm(3, mean=meanAng2, sd=stdvAng, lower.tail = T) -pnorm(2.5, mean=meanAng2, sd=stdvAng,lower.tail = T)) + (pnorm(3, mean=meanAng2, sd=stdvAng,lower.tail = F) -pnorm(3.5, mean=meanAng2,sd=stdvAng, lower.tail = F)),
        
        pnorm(3.5, mean=meanAng2, sd=stdvAng, lower.tail = F ) -pnorm(4.5, mean=meanAng2,sd=stdvAng, lower.tail = F ),
        
        pnorm(4.5, mean=meanAng2, sd=stdvAng, lower.tail = F ) -pnorm(5.5, mean=meanAng2 ,sd=stdvAng, lower.tail = F))

plot(Ang1)
plot(Ang2)
Ang1
Ang2
qnorm(0.03, mean=meanAng1, sd=stdvAng, lower.tail = T)
pnorm(1.71, mean=meanAng1, sd=stdvAng, lower.tail = T)
```





```{r}
# Compute Prices Scenarios Angus
AngP1<-t(x$mean)%*%Ang1
AngP2<-t(x$mean)%*%Ang2
AngDiff<-AngP2-AngP1
# Compute economical weights Angus in Sfr./class.
ewAng<-AngDiff/(meanAng2-meanAng1)
ewAng
```


### Carcass Conformation






### Carcass weight
The trait carcass weight has the unit kg.
For carcass weight the price plus per kg is the same on the whole scale.
Therefore I do not need to assume a standard deviation in the population.
I just need the mean for the first scenario and the function that will tell me how much the profit will change when I change the carcass weight is one kg more.
Important: Here I assume that the carcass weight changes, without a change of age at slaughter.
The profit will be here defined as the revenue minus the fixed and variable costs.

```{r ProfitCarcassWeight, eval=FALSE}
#profit per animal in Sfr. from @Burkard2013
VersProfitAnimal<- 438
KontrProfitAnimal<- 384
#mean carcass weight in kg as mean September of categories Stiere, Ochsen and Rinder of Agristat S.33.
k<-mean(c(298,256,260))
k
VersMeanCW<- k
KontrMeanCW<- k
#profit per mean kg carcass weight in Sfr.
pCW<- KontrProfitAnimal/VersMeanCW
pCW
```






