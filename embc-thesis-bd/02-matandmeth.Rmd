---
output:
  pdf_document: default
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,warning=FALSE,message=FALSE,out.width = "70%",fig.align = "center")
library(knitr)
library(kableExtra)
```

# Material and Methods {#matandmeth}

While the strategies *Deviation in age at slaughter* and *Growth models* were evaluated by literature review, the strategies *Carcass fat as auxilliary trait* and *Index over carcass traits* were evaluated by predicting the effects of their implementation in Switzerland.
Two tools were used to predict the effects of the two strategies: The genetic gain (see ??) and the rank correlation (see ??).
All necessary data was available to use these tools for the strategy *Carcass fat as auxilliary trait*.
However the index, which determines the strategy *Index over carcass traits* was missing.
Its computation was necessary for the predictions and part of this Master Thesis (see ??).
Predictions assumed within-breed breeding and were performed for the breeds Angus (Referenz für Bild Angus und Beschreibung: Angus is a extensive beef breed originating from the UK??) and Limousin (Referenz für Bild: Limousin is an intensive beef breed originating from France??).
Both beef breed populations were divided into two groups of animals which were named *calves* and *adults*.
While the group *calves* included animals which were less or 180 d old at slaughter, the group *adults* included animals which were more than 180 but less than 700 d old at slaughter.
All computations were performed using the open source programm R [@RCoreTeam2017].
The resulting codes are available in the annex (see ???)


## Index

The index consisted of three (carcass fat, carcass conformation and carcass weight) times two (adults and calves) traits for each breed.
Their weighed sum formed the value of the index $I$.
The index's value was computed as
\begin{equation}
\label{index}
I=a'u
\end{equation}
$$I=a'û$$
where $a$ was the vector of economic weights and $û$ was the vector of estimated breeding values.
Both vectors had one entry for each trait which took the same places in $a$ and $û$.
The estimated breeding values $û$ were available for all carcass traits, but the economic weights not.
An economical weight for a trait is usually defined as the change in profit per additional unit of the trait [@brascamp1985].

### Material

#### Payment System CHTAX

The only information available was the payment system CHTAX which determines the price per kg carcass weight for a beef carcass at large-scale slaughterhouses in Switzerland.
Therefore the change in profit was approximated by the difference in price per kg carcass weight determined by CHTAX.
The Swiss meat industry association Proviande is responsible for the implementation of CHTAX in Swiss slaughterhouses. 
There, Proviande employees classify beef carcasses to determine their price.
They carry out the same procedure for each beef carcass.
Firstly, Proviande employees assign the carcass to a carcass category. 
Carcass categories differ in the animals age at slaughter, number of incissors (front teeth), sex and carcass weight (see table  \@ref(tab:carcasscategory)). 
Secondly Proviande employees assign the carcass to a carcass conformation class.
The assigned carcass conformation class depends on the accentuation of certain muscels of the carcass (see table \@ref(tab:conformationclass)).
The meatier the carcass the higher the carcass conformation class.
The lowest carcass conformation class is called X and the highest class is called C.
Thirdly Proviande employees assign the carcass to a carcass fat class.
Proviande employees determine the class of carcass fat by the area and the accentuation of fat that covers the carcass (see table \@ref(tab:fatclass)).
The least fatty carcasses belong to carcass fat class 1 and the fattiest carcasses belong to carcass fat class 5.
The values in carcass weight, carcass conformation and carcass fat all influence the price of a beef carcass in the slaughterhouses.
While the price changes depending on carcass fat and carcass conformation change weekly and were taken from week 33 / 13. August in 2018 (Source???), the ones depending on carcass weight were taken from August 2016 [@Proviande2016].
For each carcass category these relative price changes differ.
In this Thesis it was assumed, that all animals which belonged to the group *adults* were assigned to the carcass categories MT, OB and RG and all animals which belonged to the group *calves* were assigned to the carcass category KV.
The mean of OB,RG and MT was formed for the relative prices of the group *adults*.
To form the relative price depending on carcass weight of calves it was assumed that their mean in carcass conformation is T+.
The resulting relative price depending on the carcass trait are shown in Figures ???.
They show that there are decreasing relative prices for too high carcass weights, increasing relative prices for increasing carcass conformation classes and high relative prices for carcass fat class 3 and the classes close to 3.

```{r carcasscategory}
x <- data.frame(Abbreviation=c("KV", "JB", "MT", "MA", "OB", "RG", "RV", "VK"), 
                                   Category=c("Calves", "Young cattle", "Young bulls", "Bulls or steers", 
                                              "Young steers", "Young heifers", "Heifers or young cows", "Cows"), 
                                   Description=c("<161 days old", " >161 days <11 months old, <320 kg live weight", 
                                              ">161 days old, no incissors", 
                                              ">161 days old, >0 incissors for bulls, >4 incissors for steers", 
                                              ">161 days old, <5 incissors", ">161 days old, <5 incissors", 
                                              ">161 days old, >4 incissors for heifers, <5 incissors for young cows", 
                                              ">161 days old"))

kable(x, booktabs=F, caption="Description of carcass categories (Proviande, 2015)") %>%
column_spec(3, width="8cm")
```

```{r fatclass}
x<-data.frame(Class = c("1", "2", "3", "4", "5"), Description=c("No fat coverage","Light fat coverage; muscels partially visible", "Average even fat coverage; muscles generally covered", "Strong fat coverage; excessive fat deposition", "Fat coverage generally excessive; bulging fat formations"))
kable(x, booktabs=F, caption="Description of carcass fat classes (Proviande, 2015)")
```
---
nocite: | 
  @Proviande2015
...
```{r conformationclass}
x<-data.frame(Class = c("C", "H","T+","T","T-","A","X"), Description=c("Leg: accentedly wide; back: accentedly wide and full; shoulder: accentedly pronounced","Leg: wide; back: wide and full; shoulder: pronounced"," ", "Leg: well developed, quite wide; back: average large; shoulder: accentedly pronounced"," ", "Leg: moderateley developed, slim, hollow; back: moderateley developed til slim ; shoulder: flat", "Leg: poorly developed, very slim, very hollow; back: slim, thin, pointy wither; shoulder: flat, hollow"))
kable(x, booktabs=T, caption="Description of carcass conformation classes (Proviande, 2015)") %>%
column_spec(1, width="0.5cm")
```

```{r cfprice,fig.cap="Relative prices of each carcass fat class within the animal groups adults and calves."}
library(knitr)
library(dplyr)
library(tidyr)
library(readr)
library(ggplot2)
CFc_price_file <- system.file("extdata","CFc_price.csv", package="Exemplary")
CFc_price  <- read_csv2(file = CFc_price_file)
CFc_price$Group <- rep("Calves",times=5)
CFa_price_file <- system.file("extdata","CFa_price.csv", package="Exemplary")
CFa_price  <- read_csv2(file = CFa_price_file)
CFa_price$Group <- rep("Adults",times=5)
CF_price <- rbind(CFc_price,CFa_price)
Class <- rep(c(1:5),times=2)
x <- cbind(CF_price,Class)
g <- ggplot(x,aes(Class,price))
g + geom_bar(stat="identity")+
  theme_classic()+theme(text = element_text(size = 15))+
   facet_grid(.~Group)+
  ylab("Relative price in Sfr. / kg")+
  xlab("Carcass fat class")
```

```{r ccprice,fig.cap="Relative prices of each carcass conformation class within the animal groups adults and calves."}
library(knitr)
library(dplyr)
library(tidyr)
library(readr)
library(ggplot2)
CCc_price_file <- system.file("extdata","CCc_price.csv", package="Exemplary")
CCc_price  <- read_csv2(file = CCc_price_file)
CCc_price$price <- CCc_price$price-min(CCc_price$price)
CCc_price$Group <- rep("Calves",times=7)
CCa_price_file <- system.file("extdata","CCa_price.csv", package="Exemplary")
CCa_price  <- read_csv2(file = CCa_price_file)
CCa_price$price <- CCa_price$price-min(CCa_price$price)
CCa_price$Group <- rep("Adults",times=7)
CC_price <- rbind(CCc_price,CCa_price)
Class <- rep(c("X","A","T-","T","T+","H","C"),times=2)
x <- cbind(CC_price,Class)
g <- ggplot(x,aes(x=factor(Class,levels=c("X","A","T-","T","T+","H","C")),price))
g + geom_bar(stat="identity")+
  facet_grid(.~Group)+
  theme_classic()+theme(text = element_text(size = 15))+
  ylab("Relative price in Sfr. / kg")+
  xlab("Carcass conformation class")
```

```{r cwaprice,fig.cap="Relative prices at thresholds in carcass weight for the animal group adults."}
library(knitr)
library(dplyr)
library(tidyr)
library(readr)
library(ggplot2)
CWa_price_file <- system.file("extdata","CWa_price.csv", package="Exemplary")
CWa_price  <- read_csv2(file = CWa_price_file)
CWa_price$Group <- rep("Adults",times=11)
CWa_threshold_file <- system.file("extdata","CWa_threshold.csv", package="Exemplary")
CWa_threshold  <- read_csv2(file = CWa_threshold_file)
CWa_threshold[10,] <- ">380"
CWa_threshold <- rbind("<290",CWa_threshold)
CWa_threshold$threshold <- factor(CWa_threshold$threshold,levels=CWa_threshold$threshold)
CWa <- cbind(CWa_price,CWa_threshold)

CWa_plot <- ggplot(CWa,aes(threshold,price))
CWa_plot + geom_bar(stat="identity")+
  theme_classic()+theme(text = element_text(size = 15))+
  ylab("Relative price in Sfr. / kg")+
  xlab("Carcass weight thresholds in kg")
```

```{r cwcprice,fig.cap="Relative prices of different ranges in carcass weight for the animal group calves."}
library(knitr)
library(dplyr)
library(tidyr)
library(readr)
library(ggplot2)
CWc_price_file <- system.file("extdata","CWc_price.csv", package="Exemplary")
CWc_price  <- read_csv2(file = CWc_price_file)
CWc_price$Group <- rep("Calves",times=12)
CWc_threshold_file <- system.file("extdata","CWc_threshold.csv", package="Exemplary")
CWc_threshold  <- read_csv2(file = CWc_threshold_file)
CWc_threshold[11,] <- ">150"
CWc_threshold <- rbind("<140",CWc_threshold)
CWc_threshold$threshold <- factor(CWc_threshold$threshold,levels=CWc_threshold$threshold)
CWc <- cbind(CWc_price,CWc_threshold)
CWc_plot <- ggplot(CWc,aes(threshold,price))
CWc_plot + geom_bar(stat="identity")+
  theme_classic()+theme(text = element_text(size = 15))+
  ylab("Relative price in Sfr. / kg")+
  xlab("Carcass weight thresholds in kg")
```

#### Population distributions

The two breeds Angus and Limousin received the same prices, but their populations show different distributions in the carcass traits.
These distributions of the groups *calves* and *adults* were used to compute their economic weights respecteveley. 
They were derived from the carcass trait records of animals which were slaughtered between 2010 and 2015 (number of animals shown in Table numberofanimals??).

```{r numberofanimals}
library(tidyr)
library(knitr)
library(kableExtra)
file_name <- system.file("extdata","number_of_animals.csv", package="Exemplary")
number_of_animals <- read.table(file = file_name, sep=";", header=TRUE)
kable(number_of_animals, booktabs=T, caption="Number of animals per breed and animal group which records were used to determine their population distributions in carcass traits.")%>%
kable_styling(latex_options=c("hold_position"))
```

While the population distributions for carcass fat and carcass conformation were determined as discrete distributions with known frequencies for each class (see Figures ??), the population distributions for carcass weight were determined using means and standard deviations (see Tables ??).

```{r cffrequencies, fig.cap="Population frequencies of Angus and Limousin in carcass fat classes."}
library(knitr)
library(dplyr)
library(tidyr)
library(readr)
library(ggplot2)
# Angus Adults
AN_CFa <- system.file("extdata","AN_CFa_freq.csv", package="Exemplary")
AN_CFa  <- read_csv2(file = AN_CFa)
colnames(AN_CFa) <- "Frequency"
AN_CFa$Breed <- c(rep("Angus",times=5))
AN_CFa$Group <- c(rep("Adults",times=5))
AN_CFa$Class <- c(1:5)

# Angus Calves
AN_CFc <- system.file("extdata","AN_CFc_freq.csv", package="Exemplary")
AN_CFc  <- read_csv2(file = AN_CFc)
colnames(AN_CFc) <- "Frequency"
AN_CFc$Breed <- c(rep("Angus",times=5))
AN_CFc$Group <- c(rep("Calves",times=5))
AN_CFc$Class <- c(1:5)

# Limousin Adults
LM_CFa <- system.file("extdata","LM_CFa_freq.csv", package="Exemplary")
LM_CFa  <- read_csv2(file = LM_CFa)
colnames(LM_CFa) <- "Frequency"
LM_CFa$Breed <- c(rep("Limousin",times=5))
LM_CFa$Group <- c(rep("Adults",times=5))
LM_CFa$Class <- c(1:5)

# Limousin Calves
LM_CFc <- system.file("extdata","LM_CFc_freq.csv", package="Exemplary")
LM_CFc  <- read_csv2(file = LM_CFc)
colnames(LM_CFc) <- "Frequency"
LM_CFc$Breed <- c(rep("Limousin",times=5))
LM_CFc$Group <- c(rep("Calves",times=5))
LM_CFc$Class <- c(1:5)

# Barplot
x <- rbind(AN_CFa,AN_CFc,LM_CFa,LM_CFc)
g <- ggplot(x,aes(Class,Frequency))
g + geom_bar(stat="identity",aes(fill=Group),position="dodge")+
  facet_grid(.~Breed)+
  theme_classic()+theme(text = element_text(size = 15))+
  ylab("Population frequency")+
  xlab("Carcass fat class")
```

```{r ccfrequencies, fig.cap="Population frequencies of Angus and Limousin in carcass conformation classes."}
library(knitr)
library(dplyr)
library(tidyr)
library(readr)
library(ggplot2)
# Angus Adults
AN_CCa <- system.file("extdata","AN_CCa_freq.csv", package="Exemplary")
AN_CCa  <- read_csv2(file = AN_CCa)
colnames(AN_CCa) <- "Frequency"
AN_CCa$Breed <- c(rep("Angus",times=7))
AN_CCa$Group <- c(rep("Adults",times=7))
AN_CCa$Class <- c("X","A","T-","T","T+","H","C")

# Angus Calves
AN_CCc <- system.file("extdata","AN_CCc_freq.csv", package="Exemplary")
AN_CCc  <- read_csv2(file = AN_CCc)
colnames(AN_CCc) <- "Frequency"
AN_CCc$Breed <- c(rep("Angus",times=7))
AN_CCc$Group <- c(rep("Calves",times=7))
AN_CCc$Class <- c("X","A","T-","T","T+","H","C")

# Limousin Adults
LM_CCa <- system.file("extdata","LM_CCa_freq.csv", package="Exemplary")
LM_CCa  <- read_csv2(file = LM_CCa)
colnames(LM_CCa) <- "Frequency"
LM_CCa$Breed <- c(rep("Limousin",times=7))
LM_CCa$Group <- c(rep("Adults",times=7))
LM_CCa$Class <- c("X","A","T-","T","T+","H","C")

# Limousin Calves
LM_CCc <- system.file("extdata","LM_CCc_freq.csv", package="Exemplary")
LM_CCc  <- read_csv2(file = LM_CCc)
colnames(LM_CCc) <- "Frequency"
LM_CCc$Breed <- c(rep("Limousin",times=7))
LM_CCc$Group <- c(rep("Calves",times=7))
LM_CCc$Class <- c("X","A","T-","T","T+","H","C")

# Barplot
x <- rbind(AN_CCa,AN_CCc,LM_CCa,LM_CCc)
g <- ggplot(x,aes(x=factor(Class,levels=c("X","A","T-","T","T+","H","C")),Frequency))
g + geom_bar(stat="identity",aes(fill=Group),position="dodge")+
  facet_grid(.~Breed)+
  theme_classic()+theme(text = element_text(size = 15))+
  ylab("Population frequency")+
  xlab("Carcass fat class")
```

```{r cwmeansd}
library(knitr)
library(dplyr)
library(tidyr)
library(readr)
library(ggplot2)
mean_sd <- system.file("extdata","mean_sd.csv", package="Exemplary")
mean_sd  <- read_csv2(file = mean_sd)
mean_sd <- as.matrix(mean_sd)
x <- data.frame(Breed=c("Angus","Angus","Limousin","Limousin"),Group=c("Adults","Calves","Adults","Calves"),Mean=as.numeric(c(mean_sd[11,3],mean_sd[12,3],mean_sd[5,3],mean_sd[6,3])),SD=as.numeric(c(mean_sd[11,4],mean_sd[12,4],mean_sd[5,4],mean_sd[6,4])))
kable(x,booktabs=T,caption="Population mean and standard deviation in kg carcass weight of Angus and Limousin.")
```

### Method

Regarding the mentioned simplifications for the determination of economic weight in Section ??, the economic weights $a$ in the *Index over carcass traits* was computed as
\begin{equation}
\label{economicweight}
a=\frac{r_1'p-r_0^Tp}{\Delta_{\mu}}
\end{equation}
$$a=\frac{r_1'p-r_0'p}{\Delta_{\mu}}$$
where $\Delta_{\mu}$ was a small increase in the present population mean of a trait (set to 0.1 class for carcass conformation and carcass fat and to 1 kg for carcass weight), $r_0$ was the vector of population frequencies belonging to each range in trait with the same price of the initial population distribution, $r_1$ was the vector of population frequencies belonging to each price range after the increase in population mean and $p$ was the vector of price changes within thresholds per kg carcass weight.
Normal distributions were assumed for all carcass traits.
They were determined by the population means and and standard deviations contained in Section popdist??.
As an example this step is shown for the group *adults*, breed Angus and trait carcass fat in Figure normdistapprox??.
To get the initial frequencies $r_0$ for each price class in these distributions, thresholds were needed.
While the thresholds of carcass weight were available (shown in Figure ??), they were not available for carcass fat and carcass conformation.
There the tresholds have been set in a way that the population frequencies known by the discrete distribution (shown in figures ??) had the same value as the population frequencies in the approximated normal distribution.
After the shift of the normal distributions by $\Delta_{\mu}$ the thresholds were assumed to be constant, but the population frequencies within the thresholds changed (shown in Figure thresholdsconstant??). 
The population frequencies within each price class have been computed again using the characteristics of the normal distribution and using the computed thresholds.
The population frequencies from the initial distribution $r_0$ and the changed distribution $r_1$ enabled the computation of the change mean price per kg carcass weight for a change in the population mean by $\Delta_{\mu}$.

```{r normdistapprox, fig.cap="Exemplary approximation of a normal distribution to a discrete distribution of the group adults, breed Angus and trait carcass fat.", echo=FALSE}
library(ggplot2)
mean_sd <- system.file("extdata","mean_sd.csv", package="Exemplary")
mean_sd  <- read_csv2(file = mean_sd)
mean_sd <- as.matrix(mean_sd)
AncfaS <- as.numeric(mean_sd[7,4])
AncfaM <- as.numeric(mean_sd[7,3])
# Angus Adults
AN_CFa <- system.file("extdata","AN_CFa_freq.csv", package="Exemplary")
AN_CFa  <- read_csv2(file = AN_CFa)
colnames(AN_CFa) <- "Frequency"
AN_CFa$Breed <- c(rep("Angus",times=5))
AN_CFa$Group <- c(rep("Adults",times=5))
AN_CFa$Class <- c(1:5)
x <- AN_CFa
g <- ggplot(x,aes(Class,Frequency))
g + geom_bar(stat="identity", width=0.5, fill="tomato2") +
  stat_function(fun = dnorm, args = list(mean = AncfaM, sd = AncfaS))+
  theme_classic()+
  ylab("Population frequency")+
  xlab("Carcass fat class")+theme(text = element_text(size = 15))
```

```{r thresholdsconstant, fig.cap="Exemplary distribution shift whith constant thresholds of the group adults, breed Angus and trait carcass fat.", echo=FALSE}
library(ggplot2)
mean_sd <- system.file("extdata","mean_sd.csv", package="Exemplary")
mean_sd  <- read_csv2(file = mean_sd)
mean_sd <- as.matrix(mean_sd)
AncfaS <- as.numeric(mean_sd[7,4])
AncfaM <- as.numeric(mean_sd[7,3])
CFa_price_file <- system.file("extdata","CFa_price.csv", package="Exemplary")
CFa_price  <- read_csv2(file = CFa_price_file)
CFa_price$Group <- rep("Adults",times=5)
CFa_price$Class <- c(1:5)

g <- ggplot(CFa_price,aes(Class,price,linetype=NULL))
g+
  geom_bar(stat="identity",show_guide=FALSE,aes(linetype=NULL))+
 ylab("Relative price in Sfr. / kg")+
  xlab("Carcass fat class") + 
  stat_function(fun = dnorm, args = list(mean = AncfaM, sd = AncfaS), aes(linetype="Initial distribution"))+
  stat_function(fun = dnorm, args = list(mean = AncfaM+0.3, sd = AncfaS),aes(linetype="New distribution"))+
    scale_linetype_manual(values=c(NULL=NULL,"Initial distribution"="solid","New distribution"="dashed"), guide = guide_legend(title=NULL))+
  theme_classic()+theme(text = element_text(size = 15))
```


## Genetic Gain

The value of genetic gain $Q$ predicts an aggregate genotype's improvement in a population in Sfr. / year [@Hazel1943].
For both strategies this improvement was defined as an increase in the aggregate genotype $H$

$$H=a'u$$

where $a$ was the vector of economic weights (see Section ??) and $u$ was the vector of true breeding values.
Both vectors had one entry for each trait which took the same places in $a$ and $u$ (length of $a$ and $u$ = 6).

### Material

Beside the economic weights (see Table ??) residual and genetic variances / covariances of the six carcass traits were used to compute the genetic gain for Angus and Limousin for the two strategies *Carcass fat as auxilliary trait* and *Index over carcass traits* (see table ??).

```{r genvarcov}
genetic_var_cov <- system.file("extdata","adults_calves_genetic_variances_covariances", package="Exemplary")
genetic_var_cov <- read.table(file = genetic_var_cov, sep=";", header=TRUE)
# Add first column with names
Trait <- c("cCC","aCC","cCF","aCF","cCW","aCW")
genetic_var_cov <- cbind(Trait,genetic_var_cov)
kable(genetic_var_cov, digits=3, booktabs=T, caption="Genetic variance / covariance matrix for the traits cCC = Carcass conformation calves, aCC = Carcass conformation adults, cCF = Carcasss fat calves, aCF = Carcass fat adults, cCW = Carcass weight calves, aCW = Carcass weight adults derived from Kunz (2018)")
```

```{r resvarcov}
residual_var_cov <- system.file("extdata","adults_calves_genetic_variances_covariances", package="Exemplary")
residual_var_cov <- read.table(file = residual_var_cov, sep=";", header=TRUE)
# Add first column with names
Trait <- c("cCC","aCC","cCF","aCF","cCW","aCW")
residual_var_cov <- cbind(Trait,residual_var_cov)
kable(residual_var_cov, digits=3, booktabs=T, caption="Residual variance / covariance matrix for the traits cCC = Carcass conformation calves, aCC = Carcass conformation adults, cCF = Carcasss fat calves, aCF = Carcass fat adults, cCW = Carcass weight calves, aCW = Carcass weight adults derived from Kunz (2018)")
```

They were computed by the method "estimation of variance components" using the software VCE created by Groeneveld and relied on data of estimated breeding values $û$ which were computed using a multivariate best linear unbiased prediction (BLUP) model [@Kunz2018].
BLUP is a statistical model combining the given knowledge about animal pedigrees, trait heritabilities, trait variances/covariances, environment factors and individual phenotypic records.
Multivariate means that BLUP accounts for the phenotypic, genetic and residual covariances between the involved traits. 
A Multivariariate BLUP computes breeding values synchronically for all involved traits [@Mrode2003].
Phenotypic records of three carcass traits were used to estimate the breeding values:

* Carcass fat [class]  

* Carcass conformation [class]

* Carcass weight [dt]

Each beef carcass delivered one record per carcass trait either as *adult* or as *calf*.
Animals 700 d or older at slaughter were not included in the model and do not get a breeding value.
Proviande employees recorded the traits at slaughterhouses in Switzerland routeneley according to CHTAX [@Proviande2015].
In the model an animals record was assumed to be dependent on the environmental conditions the animal lives in beside the genetic effects.
The environmental effects of the different conditions were included in BLUP and used to separate additive genetic effects from environmental effects on the phenotypic observations.
In BLUP the environmental effects on a phenotypic observation were either known fixed effects or unnkown random effects.
The following parameters of the animals environment were used as fixed effects in BLUP:

* Proviande carcass classifier for carcass fat and carcass conformation

* Sex

* Slaughterhouse

Age and squared age at slaughter were used as covariables in the model.
Beside the random animal effect which was the breeding value, there was only one random effect used in the model:

* Farm x year

### Methods

The genetic gain was computed considering the "Bulmer effect" [@Bulmer1971].
The resulting asymptotic genetic gain $Q_H^*$ was computed using the equation for two selection paths [@VonRohr1998].
It was expressed as
\begin{equation}
\label{geneticgain}
Q_H^* = \frac {\sum_{y=1}^{2} i_yr_y^*\sigma^*}{\sum_{y=1}^{2}L_y}
\end{equation}
$$Q_H^*= \frac {\sum_{y=1}^{2} i_yCov(I,H)^*_y}{\sum_{y=1}^{2}L_y}$$
where $i$ was the selection intensity, $Cov(I,H)^*$ was the asymptotic covariance between the selection index $I$ and the aggregate genotype $H$, $L$ was the generation intervall, $y$ was the selection path with 1 = male and 2 = female and $*$ indicated, that the value was corrected for the "Bulmer effect".
From its value correlated genetic gains $Q_m^*$ were computed for all carcass traits $m$ individually using the equation

$$Q^*_m=Q_H^*Cov(u_m,I)^*(Var(I)^*)^{-1}$$
where $Cov(u_m,I)^*$ was the asymptotic covariance between a true breeding value of trait $m$ and the aggregate genotype $H$ and $Var(I)^*$ was the asymptotic variance of the selection index $I$.

The genetic gain was based on assumptions of a probable future breeding scenario.
It was the same for both strategy *Carcass fat as auxilliary trait* and *Index over carcass traits*.
This breeding scenario was determined by generation intervall $L$, proportion selected, number of offspring and the proportion of calves and adults in the offspring separateley for a male and female selection candidate (see Table ??).

```{r breedingscenario}
library(dplyr)
# number of offspring
offspring_file <- system.file("extdata","number_of_offspring", package="Exemplary")
male_offspring <- read.table(file = offspring_file, sep=";", header=TRUE) %>%
  select(male)
male_offspring <- as.numeric(male_offspring)
female_offspring <- read.table(file = offspring_file, sep=";", header=TRUE) %>%
  select(female)
female_offspring <- as.numeric(female_offspring)
# generation intervall
generation_intervall <- system.file("extdata","generation_intervall", package="Exemplary")
male_generationintervall <- read.table(file = generation_intervall, sep=";", header=TRUE) %>%
  select(male)
male_generationintervall <- as.numeric(male_generationintervall)
female_generationintervall <- read.table(file = generation_intervall, sep=";", header=TRUE) %>%
  select(female)
female_generationintervall <- as.numeric(female_generationintervall)
# proportion calves adults
proportion_file <- system.file("extdata","proportion_calves_adults", package="Exemplary")
proportion_adults <- read.table(file = proportion_file, sep=";", header=TRUE) %>%
  select(adults)
proportion_adults <- as.numeric(proportion_adults)
proportion_calves <- read.table(file = proportion_file, sep=";", header=TRUE) %>%
  select(calves)
proportion_calves <- as.numeric(proportion_calves)
# proportion selected
proportionselected_file <- system.file("extdata","proportion_selected", package="Exemplary")
male_proportionselected <- read.table(file = proportionselected_file, sep=";", header=TRUE) %>%
  select(male)
male_proportionselected <- as.numeric(male_proportionselected)
female_proportionselected <- read.table(file = proportionselected_file, sep=";", header=TRUE) %>%
  select(female)
female_proportionselected <- as.numeric(female_proportionselected)

breeding_scenario <- data.frame(Determinant=c("Generation intervall [y]","Proportion selected","Number of offsprin", "Proportion of adults","Proportion of calves"),Male=c(male_generationintervall,male_proportionselected,male_offspring,proportion_adults,proportion_calves),Female=c(female_generationintervall,female_proportionselected,female_offspring,proportion_adults,proportion_calves))
kable(breeding_scenario, digits=3, booktabs=T, caption="Breeding scenario determinants for male and female selection candidates.")

```

There it was assumed that: 

* population size was infiniteley large, 

* selection candidates were randomly mated, 

* generations in the population were discrete, 

* all breeding values were computed using the same amount of information,

* selection candidates had no record,

* the traits are and stay normally distributed after selection,

* an animal could not have a record as both *adult* and *calf*.

While the generation intervall $L$ was therefore determined, the intensity of selection $i$ was computed using the R command `dnorm(qnorm(1-p))/p` where `p` was the proportion selected.
The asymptotic covariance between selection index and aggregate genotype $Cov(I,H)^*$ was computed as 
\begin{equation}
\label{covindagg}
Cov(I,H)^*=\sqrt{b'P^*b}
\end{equation}
$$Cov(I,H)^*=\sqrt{b'P^*b}$$
, the asymptotic covariance between a true breeding value of trait $m$ and the aggregate genotype $H$ was computed as

$$Cov(u_m,I)^*=b'G^*_m$$
and the asymptotic variance of the selection index $I$ was computed as

$$Var(I)^*=b'P^*b$$

where $P^*$ was the asymptotic variance covariance matrix between the information sources of the selection index $G^*_m$ was the asymptotic variance covariance matrix between a true breeding value and the selection index and $b$ was the vector of regression coefficients to maximize the correlation between $I$ and the aggregate genotype $H$.
The vector of regression coefficients $b$ was computed as
\begin{equation}
\label{regrcoeff}
b=P^{-1}Ga
\end{equation}
$$b=P^{-1}Ga$$
where $P$ was the variance covariance matrix between the information sources of $I$, $G$ was the covariance matrix between $I$ and $H$ and $a$ was the vector of economic weights.
Both $P^*$ and $b$ differed between the stratgies *Carcass fat as auxilliary trait* and *Index over carcass traits*, because their selection index $I$ was differently defined.
According to the selection index theory from @Hazel1943 the selection index is defined as linear regression from the information sources to the aggregate genotype $H$.

#### Strategy Carcass fat as auxilliary trait

For the strategy *Carcass fat as auxilliary trait* it was assumed that the information sources were the estimated breeding values of carcass fat for both *adults* and *calves*.
This resulted in the selection index
\begin{equation}
\label{selindcf}
I_{CF}= bû_{CF}
\end{equation}
$$I_{CF}= bû_{CF}$$
where $b$ was the vector of regression coefficients and $û_{CF}$ was the vector of estimated breeding values of carcass fat for *adults* and *calves* (length of $b$ and $û_{CF}$ = 2).
Due to the assumption that the variance of BLUP computed estimated breeding values is the same as the variance of true breeding values, it was valid to set $P^*$ to
\begin{equation}
\label{covcf}
P^*=C^*_{CF}
\end{equation}
$$P^*=C^*_{CF}$$
where $C^*_{CF}$ was the asymptotic covariance matrix between true and estimated breeding values of the two estimated breeding values in $û_{CF}$ (resulted in a 2 x 2 matrix).
Additionally the covariance matrix between selection index and aggregate genotype $G$ could be set to
$$G=C_{CF,H}$$
and asymptotic variance covariance matrix between a true breeding value and the selection index could be set to
$$G^*_m=C^*$$
where $C_{CF,H}$ was the covariance matrix of the two estimated breeding values $û_{CF}$ and the true breeding values in $H$ (resulted in a 2 x 6 matrix).

#### Strategy Index over carcass traits

For the strategy *Index over carcass traits* it was assumed that the information sources were the estimated breeding values of all carcass traits for both *adults* and *calves*.
Therefore $b$ could be replaced in the selection index by the vector of economic weights $a$ because the variance covariance matrix $P$ between the information sources in $I$ was the same as the covariance matrix $G$ between $I$ and $H$ in the definition of $b$ (see Equation ??).
This resulted in the selection index
\begin{equation}
\label{selindindex}
I_{Index}= aû_{Index}
\end{equation}
$$I_{Index}= aû_{Index}$$
where $a$ was the vector of economic weights and $û_{Index}$ was the vector of estimated breeding values of all carcass traits for *adults* and *calves* (length of $a$ and $û_{Index}$ = 6).
The asymptotic variance covariance matrix between the information sources of the selection index $I$ was set to
\begin{equation}
\label{covind}
P^*=C^*_{Index}
\end{equation}
$$P^*=C^*_{Index}$$
where $C^*_{Index}$ was the covariance matrix between the six estimated breeding values $û_{Index}$ and the true breeding values in $H$ (resulted in a 6 x 6 matrix).

#### Asymptotic covariance matrix between true and estimated breeding values

The asymptotic covariance matrix between true and estimated breeding values of all carcass traits was therefore necessary to compute $$, $$ and

## Rank Correlations

To get $C_y^*$ we used the formula:

\begin{equation}
\label{Casympt}
\begin{bmatrix}
C_1^* \\
C_2^*
\end{bmatrix}
=
\left( 
\begin{bmatrix}
1+1/2k_1  &  1/2k_2 \\
1/2k_1    &  1+1/2k_2
\end{bmatrix}^{-1}
\otimes I_n
\right)
\begin{bmatrix}
C_1 \\
C_2
\end{bmatrix}
\end{equation}

Where

* $k$ = factor of variance reduction

* $n$ = number of traits involved

* $I$ = identity matrix of dimension n


We computed $k$ using the formula:

\begin{equation}
\label{kvarred}
k_y=i_y(i_y-x_y)
\end{equation}


Where 

* $x$ = value of trunctation on the x-axis of the populations normal distribution [standard deviations]

We computed $x_y$ from the proportion selected using the R-command `qnorm(proportion_selected, lower.tail = FALSE)`

To get the covariance matrix between true and estimated breeding value before selection $C_y$ we used the following formula:

\begin{equation}
\label{kvarred}
C_y=A_y \otimes G-PEV_y
\end{equation}

Where

* $A$ = numerator relationship matrix of dimension q x q; q = number of levels for random effects.

* $\otimes$ = sign for kronecker product

* $PEV$ = prediction error variance




#### Response to selection based on Pimentel

In contrast to the approach of Phocas and Vonrohr, Pimentel does not assume a probable breeding scenario using records from relatives.
Pimentel's approach is based on the selection index theory developed by @Hazel1943.
The selection index theory describes how an aggregate genotype can be computed.
The term genotype is here used as synonym for breeding value.




\begin{equation}
Q_m^*= \frac { \sum_{y=1}^{2} i_ya^T(C_y^*)_m \sqrt{a^TC_y^*a}}{\sum_{y=1}^{2}L_y}
(\#eq:Qm)
\end{equation}

Watch \@ref(eq:Qm)

\begin{equation}
\label{Qm}
Q_m^*= \frac { \sum_{y=1}^{2} i_ya^T(C_y^*)_m \sqrt{a^TC_y^*a}}{\sum_{y=1}^{2}L_y}
\end{equation}

see \autoref{Qm}

@Phocas1996













