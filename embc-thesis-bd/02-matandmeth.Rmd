---
output:
  pdf_document: default
---
```{r, echo=FALSE}
library(knitr)
library(kableExtra)
```

# Material and Methods {#matandmeth}

While the strategies *Deviation in age at slaughter* and *Growth models* were evaluated by literature review, the strategies *Carcass fat as auxilliary trait* and *Index over carcass traits* were evaluated by predicting the effects of their implementation in Switzerland.
Two tools were used to predict the effects of the two strategies: The genetic gain (see ??) and the rank correlation (see ??).
All necessary data was available to use these tools for the strategy *Carcass fat as auxilliary trait*.
However the index, which determines the strategy *Index over carcass traits* was missing.
Its computation was necessary for the predictions and part of this Master Thesis (see ??).
Predictions assumed within-breed breeding and were performed for the breeds Angus (Referenz für Bild Angus und Beschreibung: Angus is a extensive beef breed originating from the UK??) and Limousin (Referenz für Bild: Limousin is an intensive beef breed originating from France??).
Both beef breed populations were divided into groups of animals which were named *calves* and *adults*.
While the group *calves* included animals which were less or 180 d old at slaughter, the group *adults* included animals which were more than 180 but less than 700 d old at slaughter.
All computations were performed using the open source programm R [@RCoreTeam2017].
The resulting codes are available in the annex (see ???)


## Index

The index consisted of 3 (carcass fat, carcass conformation and carcass weight) x 2 (adults and calves) traits for each breed.
Their weighed sum formed the value of the index $I$.
It was computed as

\begin{equation}
\label{Index}
I=a'u
\end{equation}
$$I=a'u$$
where $a$ is the vector of economic weights and $u$ is the vector of estimated breeding values.
Both vectors had one entry for each trait which took the same places in the vectors.
The economical weight for a trait is usually defined as the change in profit per additional unit of the trait.
However, there was no information available about the true change in profit per trait unit.
The only information available was the payment system CHTAX which determines the price per kg carcass weight for a beef carcass at large-scale slaughterhouses in Switzerland.
Therefore the change in profit was approximated by the difference in price per kg carcass weight determined by CHTAX.

The Swiss meat industry association Proviande is responsible for the implementation of CHTAX in Swiss slaughterhouses. 
There, Proviande employees classify beef carcasses to determine their price.
They carry out the same procedure for each beef carcass.
Firstly, Proviande employees assign the carcass to a carcass category. 
Carcass categories differ in the animals age at slaughter, number of incissors (front teeth), sex and carcass weight (see table  \@ref(tab:carcasscategory)). 
```{r carcasscategory, echo=FALSE}
x <- data.frame(abbreviation=c("KV", "JB", "MT", "MA", "OB", "RG", "RV", "VK"), 
                                   category=c("calves", "young cattle", "young bulls", "bulls or steers", 
                                              "young steers", "young heifers", "heifers or young cows", "cows"), 
                                   description=c("<161 days old", " >161 days <11 months old, <320 kg live weight", 
                                              ">161 days old, no incissors", 
                                              ">161 days old, >0 incissors for bulls, >4 incissors for steers", 
                                              ">161 days old, <5 incissors", ">161 days old, <5 incissors", 
                                              ">161 days old, >4 incissors for heifers, <5 incissors for young cows", 
                                              ">161 days old"))

kable(x, booktabs=T, caption="Description of carcass categories (Proviande, 2015)") %>%
column_spec(3, width="8cm")
```
Secondly Proviande employees assign the carcass to a carcass conformation class.
The assigned carcass conformation class depends on the accentuation of certain muscels of the carcass (see table \@ref(tab:conformationclass)).
The meatier the carcass the higher the carcass conformation class.
The lowest carcass conformation class is called X and the highest class is called C.
Thirdly Proviande employees assign the carcass to a carcass fat class.
Proviande employees determine the class of carcass fat by the area and the accentuation of fat that covers the carcass (see table \@ref(tab:fatclass)).
The least fatty carcasses belong to carcass fat class 1 and the fattiest carcasses belong to carcass fat class 5.
```{r fatclass, echo=FALSE}
x<-data.frame(class = c("1", "2", "3", "4", "5"), description=c("no fat coverage","light fat coverage; muscels partially visible", "average even fat coverage; muscles generally covered", "strong fat coverage; excessive fat deposition", "fat coverage generally excessive; bulging fat formations"))
kable(x, booktabs=T, caption="Description of carcass fat classes (Proviande, 2015)") %>%
column_spec(1, width="0.5cm")

```
---
nocite: | 
  @Proviande2015
...
```{r conformationclass, echo=FALSE}
x<-data.frame(class = c("C", "H","T+","T","T-","A","X"), description=c("leg: accentedly wide; back: accentedly wide and full; shoulder: accentedly pronounced","leg: wide; back: wide and full; shoulder: pronounced"," ", "leg: well developed, quite wide; back: average large; shoulder: accentedly pronounced"," ", "leg: moderateley developed, slim, hollow; back: moderateley developed til slim ; shoulder: flat", "leg: poorly developed, very slim, very hollow; back: slim, thin, pointy wither; shoulder: flat, hollow"))
kable(x, booktabs=T, caption="Description of carcass conformation classes (Proviande, 2015)") %>%
column_spec(1, width="0.5cm")
```


In this Thesis it was assumed, that all animals which belong to the group *adults* were assigned to the carcass categories MT, OB and RG and all animals which belong to the group *calves* were assigned to the carcass category KV.




## Genetic Gain
The genetic gain was the mean change in price per kilogramm carcass weight per year in two Swiss beef breed populations.
From its value correlated genetic gains were computed for all carcass traits individually.
They express the mean change in trait unit or genetic standard deviation per year.
Detailed information about the computation of the genetic gain is available in ???.

## Rank Correlations



## Strategies to improve Early Maturity
To breed for early maturity employees from Qualitas AG have proposed four strategies, which will be evaluated in this thesis.
One of them is to derive the trait early maturity from the trait carcass fat.

### Deriving Early Maturity from Carcass Fat

The derivation of one trait to another requires that the involved traits are closely correlated. 
Therefore carcass fat should be highly correlated with early maturity.
The assumed correlation is based on the theoretical knowledge about growth and body composition in beef cattle.
Usually muscles grow in an earlier stadium of growth than fat tissue [@Thonney2015].
This indicates that carcass fat is usually the limiting factor for early maturity in beef cattle.
Based on this knowledge of beef growth, carcass fat could be a usefull trait to derive early maturity.
Therefore "Mutterkuh Schweiz", the Swiss beef breeders association, has introduced a breeding value for carcass fat in Summer 2018.

The characteristics of the breeding value carcass fat were the material to asses the suitability of carcass fat for deriving early maturity. 
To describe and discuss carcass fat as a trait to derive early maturity, the creation and evaluation procedure of the breeding value carcass fat will be explained here.
I will use the results from the breeding value estimation as "material" to evaluate the efficiency of the breeding program.
The explanations refering to the creation of the breeding value car are based on the documentation of @Kunz2018.

A breeding value tells you about the additive genetic merit of an animal in comparison to the reference population in units of the measured trait.
The breeding value is a widespread tool to rank animals in a breeding program.
To compute the breeding values for carcass fat a multivariate best linear unbiased prediction (BLUP) model is used [@Kunz2018].
BLUP is a statistical model combining the given knowledge about animal pedigrees, trait heritabilities, trait variances/covariances, environment factors and individual phenotypic records.
Multivariate means that BLUP accounts for the phenotypic, genetic and residual covariances between the involved traits. 
A Multivariariate BLUP computes breeding values synchronically for all involved traits [@Mrode2003].
Phenotypic records of three carcass traits are used to estimate a breeding value for carcass fat:

* carcass fat [class] (table \@ref(tab:fatclass)) 
* carcass conformation [class] (table \@ref(tab:conformationclass))
* carcass weight [dt] (section \@ref(CHTAX))

Each beef carcass delivers one record per carcass trait.
Proviande employees record the traits at slaughterhouses in Switzerland routeneley according to CHTAX [@Proviande2015].

An animals record is dependent on the environmental conditions the animal lives in beside the genetic effects.
The environmental effects of the different conditions have been included in BLUP and used to separate additive genetic effects from environmental effects on the phenotypic observations.
In BLUP the environmental effects on a phenotypic observation are either known fixed effects or unnkown random effects.
To compute a breeding value for carcass fat, carcass conformation and carcass weight the following parameters of the animals environment have been used as fixed effects:

* Proviande carcass classifier for carcass fat and carcass conformation
* sex
* age and squared age at slaughter (as covariable)
* slaughterhouse

Beside the random animal effect which is the breeding value, there is only one random effect used in the model:

* farm x year

Ultimateley the breeding values are divided into two groups based on age at slaughter of the animal which delivered the record.
While the group "calves (c)" includes animals which are less or 180 d old at slaughter, the group "stirks (s)" includes animals which are more than 180 d but less than 700 d old at slaughter.
Animals 700 d or older at slaughter are not included in the model and do not get a breeding value.

The computation of multivariate BLUP breeding values enabled the estimation of variance components in the population.
Variance components consist of phenotypical, genetic, fixed effects and residual variances/covariances.
They have been computed by the method "estimation of variance components" using the Software VCE created by Groeneveld [@Kunz2018].
The variance components distinguish as well between the two groups of breeding values "calves" (see table \@ref(tab:calvesvariancecomponents)) and "stirks" (see table \@ref(tab:stirksvariancecomponents)).

```{r calvesvariancecomponents, echo=FALSE}
library(knitr)
library(kableExtra)
g<-data.frame(c("cCC","cCF", "cCW"), c(0.4015, -0.00993, 0.01828), c( -0.00993, 0.12067,0.00050), c(0.01828,0.00050,0.00311))
colnames(g) <- c(" ","cCC","cCF", "cCW")

r<-data.frame(c(0.35845, 0.13154, 0.02907), c( 0.35845, 0.23651,0.02463), c(0.02907,0.23651,0.00904))
colnames(r) <- c("cCC","cCF", "cCW")

p<-data.frame(c(0.79947, 0.14951, 0.05394), c( 0.14951, 0.39365,0.02979), c(0.05394,0.02979,0.06395), c(0.50221, 0.30654, 0.22078))
colnames(p) <- c("cCC","cCF", "cCW", "heritability")

cvc<-cbind(g,r,p)
kable(cvc, digits=3, booktabs=T, caption="Genetic and phenotypic variances-covariances for calves (c) derived from Kunz (2018)") %>%
kable_styling(latex_options=c("hold_position")) %>%
 add_header_above(c(" ","genetic"=3,"residual"=3, "phenotypic"=3," ")) %>%
  column_spec(c(1,4,7,10), border_right = T)

```
---
nocite: | 
  @Kunz2018
...

```{r stirksvariancecomponents, echo=FALSE}
library(knitr)
library(kableExtra)
sg<-data.frame(name=c("sCC","sCF", "sCW"),sCC= c(0.4013, -0.00655, 0.03387), sCF=c( -0.00655, 0.13028,0.01322), sCW=c(0.03387,0.01322,0.01947))
colnames(sg) <- c(" ","sCC","sCF", "sCW")

sr<-data.frame(sCC=c(0.26631, 0.00931, 0.04903),sCF= c( 0.00931, 0.19451,0.02162),sCW= c( 0.04903,0.02162,0.03466))
colnames(sr) <- c("sCC","sCF", "sCW")

sp<-data.frame(sCC=c(0.71754, 0.07159, 0.09911), sCF=c(0.07159, 0.36439,0.04989), sCW=c(0.09911,0.04989,0.06395), heritability=c(0.55928, 0.35752, 0.30447))
colnames(sp) <- c("sCC","sCF", "sCW", "heritability")
svc<-cbind(sg,sr,sp)
kable(svc, digits=3, booktabs=T, caption="Genetic, phenotypic and residual variances-covariances for stirks (s) derived from Kunz (2018)") %>%
 add_header_above(c("","genetic"=3,"residual"=3, "phenotypic"=3,""))

```



#### Genetic gain equation derivation

The response to selection is highly dependent on the breeding conditions in a population.
The response to selection achieved in one generation is the product of the intensity of selection ($i$), the square root of the accuracy of the breeding value ($r$) and the genetic variance ($\sigma_{g}$).
\begin{equation}
\label{Qgeneration}
Q = ir\sigma_{g}
\end{equation}
$$Q = ir\sigma_{g}$$
The intensity of selection describes, how big the proportion of animals chosen to be parents compared to the whole population is.
For example the intensity of selection is higher when you choose two of 10 animals to be parents than if you choose 5 animals to be parents.
The accuracy of the breeding value tells, how big chances are that the best animals are chosen as parents. 
For example if you have no means to distinguish between the best parents because you do not have any information about them (no records of them or relatives) or you know that the characteristics of the parents will not be inherited to their progeny (heritability=0) it would be completeley random if you choose the best parents.
The additive genetic variance in the population limits the potential for improvement using selection.
For example if you have cows that have the additive genetic potential of daily milk yields in kg of 1, 5, 7, 20 respecteveley you have the potential to get a mean additive genetic potential in milk yield of almost 20 kg by selecting the best animals for parents. 
If you have cows with an additive genetic potential in daily milk yields of 2, 3, 5, 6 respectiveley you will reach not more than an additive genetic potential of 6 kg even if your intensity and accuracy of selection is very high.
The intensity of selection is a value usually based on the usual percentage of animals chosen as parents. In this value the assumption of normal distribution for all traits is assumed (Here formula).

In \autoref{Qgeneration} I computed the response to selection per generation.
However sometimes it occurs that different generations overlap.
Therefore it is usually more suitable to compute the response to selection per year.
To do so \autoref{Qgeneration} extends with the term mean generation interval ($L$) in years.

\begin{equation}
\label{Qyear}
Q = \frac {ir\sigma_{g}}{L}
\end{equation}
$$Q = \frac {ir\sigma_{g}}{L}$$

For example usually selection on beef sires occurs when about 6 years old.
$L$ Would then be 7 y in this case to get the response to selection per year.
In \autoref{Qyear} we make the assumption that we know the mean generation intervall, the intensity of selection and the accuracy of the breeding value for all selection paths.
Or we know that there is no difference in these parameter in different selection paths.
A selection path is defined as a possibility to select on a population.
Different selection paths differ in the type of population on which selection occurs and on the type of selected animals.
Usually we organize selection paths in four categories: Dam - dam, dam - sire, sire - dam, sire - sire. 
There the first term indicates the type of population on which selection occurs and the second term indicates the type of the selected animals.
In case you know only the parameters of each selection path you can transform the formula \autoref{Qyear} to
\begin{equation}
\label{Qselectionpath}
Q = \frac {ir\sigma_{g}}{L}
\end{equation}
$$Q = \frac {\sum_{y=1}^{s} i_yr_y\sigma_g}{\sum_{y=1}^{s}L_y}$$
where $y$ is a selection path and $s$ is the number of selection paths you choose to include in \autoref{Qselectionpath}.
Some years ago @Bulmer1971 discovered that selection on a population reduces the genetic variance of the population over time to an asymptotic value.
Considering the so called "Bulmer Effect" you should use the asymptotic genetic variance and the asymptotic accuracy of breeding values when computing the response to selection.
\begin{equation}
\label{Qasymptotic}
Q^* = \frac {\sum_{y=1}^{2} i_yr_y^*\sigma^*}{\sum_{y=1}^{2}L_y}
\end{equation}
$$Q^* = \frac {\sum_{y=1}^{s} i_yr_y^*\sigma_g^*}{\sum_{y=1}^{s}L_y}$$
In a population already selected for a long time you may probably disregard the Bulmer effect.
I would for sure facilitaty the computation of response to selection.
For example, when you have the accuracy for a breeding value provided by the breeding value estimation, you can just insert its value in the \autoref{Qasymptotic}.
Another approach to compute the accuracies of breeding values is to use the selection index theory developed by @Hazel1943.
There you have to mimic breeding value estimation using linear regression of breeding values on phenotypes.
Then you need to find the regression coefficients and compute the accuracy of a breeding value.
An index in this context is a synonym for estimated breeding value.
You can compute the index by summing phenotypic records $x$ on a selection candidate and weigh them with $b$ according to their significance for the breeding value.
\begin{equation}
\label{selectionindex}
Â=\sum_{x=1}^{q}b_x*x_x
\end{equation}
$$Â=\sum_{z=1}^{q}b_zx_z$$
For example you would like to compute the breeding value or index of cattle sire.
You have available the phenotypic observation of a full sib and a half sib in which is known as difference to the population mean.
You should now choose $b$ for the half sib to be equal or less than 0.25 and for the full sib equal or less than 0.5. 
$b$ can further decrease when heratibility is low.
The accuracy of selection $r$ is the correlation between the true breeding value and the estimated breeding value.
For selection index theory it is 
\begin{equation}
\label{accuracyselectionindex}
r= \frac { \sqrt{b'G}}{\sigma_g}
\end{equation}
$$r= \frac { \sqrt{b'G}}{\sigma_g} $$
Using this approach including the "Bulmer effect" I was able to compute the genetic gains for the carcass traits dependent on their economical value.


Therefore we created likely scenarios simulating breeding conditions for male and female selection candidates to assess the effect of breeding conditions on response to selection for this case.

The chosen scenarios differ in the number and relationship of relatives the selection candidates have and the proportion of selected male/female animals that will be parents of the beef cattle population in a generation.
From the proportion of selected animals we have computed intensities of selection applied on the population assuming that carcass fat, carcass conformation and carcass weight are normally distributed in the examined beef cattle population.
We used the R command 
Then we assigned economical weights as additional revenue in Sfr. / unit of trait gain for the involved traits carcass fat, carcass conformation and carcass weight.
The values for the scenarios are available at ... Here I will create a table combining the assumed values for each scenarion (number of siblings, number of half siblings, proportion selected, intensity of selection, economical weights)

For each scenario we have predicted the specific traits improvement $Q_m^*$ from the aggregate genotype asymptotic response to selection using linear regression as shown in \autoref{Qm} [@Andersen1994].
All computations have been conducted using RStudio [@RStudio2016].

\begin{equation}
\label{Qm}
Q_m^*= \frac {\sum_{y=1}^{2} i_ya^T(C_y^*)_m \sqrt{a^TC_y^*a}}{\sum_{y=1}^{2}L_y}
\end{equation}

Where:

* $Q$ = response to selection [trait unit / years]

* $_m$ = trait: carcass fat, carcass conformation or carcass weight. Here it means that we only take $m$ part of the matrix $C$ which makes it a $q x q$ dimensional matrix.

* $^*$ = indicates that reduction of variance during selection has been taken into account known as "Bulmer effect", values turn to asymptotic values [@Bulmer1971].

* $_y$ = sex of the predicted selection candidate (1 = male, 2 = female)

* $i$ = intensity of selection

* $C$ = covariance matrix between true and estimated breeding value before selection of dimesion $qn x qn$ ; $n$ = number of traits, $q$ = number of levels for random effects

* $a$ = vector of economical weights [Sfr. / trait unit]

* $L$ = generation intervall [years]


We have computed the response to selection $Q^*$ of the aggregate genotype based on the following formula derived from [@Phocas1996]:

\begin{equation}
\label{Qagr}
Q^* = \frac {\sum_{y=1}^{2} i_yr_y^*\sigma^*}{\sum_{y=1}^{2}L_y}
\end{equation}

Where:

* $r$ = accuracy of aggregate genotype

* $\sigma$ = standard deviation of aggregate genotype

We computed $r^*_y$ and $\sigma^*$ using the following formulas:

\begin{equation}
\label{rasympt}
r^*=\sqrt{\frac {a^TC_y^*a}{a^TG^*a}}
\end{equation}

and

\begin{equation}
\label{sigasympt}
\sigma^*=\sqrt{a^TG^*a}
\end{equation}

Where

* $G$ = genetic variance-covariance matrix

To get $C_y^*$ we used the formula:

\begin{equation}
\label{Casympt}
\begin{bmatrix}
C_1^* \\
C_2^*
\end{bmatrix}
=
\left( 
\begin{bmatrix}
1+1/2k_1  &  1/2k_2 \\
1/2k_1    &  1+1/2k_2
\end{bmatrix}^{-1}
\otimes I_n
\right)
\begin{bmatrix}
C_1 \\
C_2
\end{bmatrix}
\end{equation}

Where

* $k$ = factor of variance reduction

* $n$ = number of traits involved

* $I$ = identity matrix of dimension n


We computed $k$ using the formula:

\begin{equation}
\label{kvarred}
k_y=i_y(i_y-x_y)
\end{equation}


Where 

* $x$ = value of trunctation on the x-axis of the populations normal distribution [standard deviations]

We computed $x_y$ from the proportion selected using the R-command `qnorm(proportion_selected, lower.tail = FALSE)`

To get the covariance matrix between true and estimated breeding value before selection $C_y$ we used the following formula:

\begin{equation}
\label{kvarred}
C_y=A_y \otimes G-PEV_y
\end{equation}

Where

* $A$ = numerator relationship matrix of dimension q x q; q = number of levels for random effects.

* $\otimes$ = sign for kronecker product

* $PEV$ = prediction error variance




#### Response to selection based on Pimentel

In contrast to the approach of Phocas and Vonrohr, Pimentel does not assume a probable breeding scenario using records from relatives.
Pimentel's approach is based on the selection index theory developed by @Hazel1943.
The selection index theory describes how an aggregate genotype can be computed.
The term genotype is here used as synonym for breeding value.




\begin{equation}
Q_m^*= \frac { \sum_{y=1}^{2} i_ya^T(C_y^*)_m \sqrt{a^TC_y^*a}}{\sum_{y=1}^{2}L_y}
(\#eq:Qm)
\end{equation}

Watch \@ref(eq:Qm)

\begin{equation}
\label{Qm}
Q_m^*= \frac { \sum_{y=1}^{2} i_ya^T(C_y^*)_m \sqrt{a^TC_y^*a}}{\sum_{y=1}^{2}L_y}
\end{equation}

see \autoref{Qm}

@Phocas1996


# Economic weights

Economic weights are weighing factors to produce an aggregate genotype $H$

\begin{equation}
\label{AggregateGenotype}
H=\sum{a_iu_i}
\end{equation}

where

$a$ is an economic weight,

$u$ is a true breeding value and

$i$ is a trait.

In this thesis the aggregate genotype consists of the traits carcass fat, carcass conformation and carcass weight.
Consequently the three traits needed an economical weight each.
The economical weight for a trait is the change in profit in Swiss Francs (Sfr.) per additional unit of the trait.
It is given by the equation

\begin{equation}
\label{EconomicWeight}
a=\frac{\Delta_p}{\Delta_{\mu}}
\end{equation}

where

$a$ is the economic weight of a trait,

$\Delta_p$ is the change in revenue in Sfr and

$\Delta_{\mu}$ is the increase in population mean by one unit of a trait.


However, there is no information available about the true change in profit per unit carcass fat, carcass conformation and carcass weight.
This change is therefore approximated by only using the difference in revenue which is caused by price differences per kg carcass weight in the slaughterhouse.
The change in revenue $\Delta_p$ has been computed by the equation

\begin{equation}
\label{DeltaP}
\Delta_p=\frac{r_1^Tp-r_0^Tp}{0.1}
\end{equation}

where

$r$ is the vector of population frequencies belonging to each price class,

$p$ is the vector of price change per kg carcass weight,

$T$ means, it is the transpose,

$0$ indicates the initial population and

$1$ indicates the population after the change in population mean by 0.1.

The price changes per unit of a carcass trait $p$ are based on CHTAX.
There the price differences do not have the same value over the whole scale of the carcass traits.
For example the change in revenue from carcass fat class 1 to 2 is not the same as from 2 to 3.
The changes in revenue are different for "adults" and "calves".
It is assumed that the group "calves" are all classified to the carcass category KV while the group "adults" are classified to MT, OB or RG.
For the group "adults" the changes in revenue have been taken from a weighed mean of MT, OB and RG.
Its weights have been chosen from the relative number of slaughtered carcasses classified to MT, OB and RG.
Due to the non-linear changes in revenue for the carcass traits, the economic weight depends on the initial distribution of the population over the scale of a carcass trait.
The initial distribution is different for each beef cattle breed, which also results in different economic weights for each breed.
In this thesis the economic weights have been computed for the breeds Angus and Limousin.

While the revenue changes from class to class in carcass fat and carcass conformation, it changes at thresholds in carcass weight.
In a continous normal distribution thresholds are needed to get the frequencies of population $r$ for each price class.
The price class indicates a range of a carcass trait at which the price per kg carcass weight stays the same.
For carcass fat and carcass conformation the thresholds have been difficult to set, because they are discreteley distributed (see Figure \@ref(fig:BarplotInitialfrequenciesCF)).
There the thresholds have been set after the creation of the initial normal distribution approximated to the discrete distribution (see Figure \@ref(fig:NormDistApprox)).
The tresholds have been set in a way that the population frequencies known by the discrete distribution have fitted to the frequencies in the normal distribution.
After this step the procedure to compute the economic weight was again basically the same for all carcass traits:
The initial normal distribution conserved its shape (standard deviation constant), but has been shifted by increasing the mean by 0.1 (see Figure \@ref(fig:ShiftMean)).
Then the population frequencies within each price class have been computed again using the characteristics of the normal distribution and using the computed thresholds.
The population frequencies from the initial distribution $0$ and the changed distribution $1$ enabled the computation of the change in revenue for a change in population mean by $\Delta_{\mu}$.

```{r BarplotInitialfrequenciesCF, echo=FALSE, fig.cap="Population frequencies for each carcass fat class in Angus and Limousin calves and adults (Kunz, 2018)"}
library(knitr)
library(kableExtra)
#Vectors of animal numbers Carcass fat 
#Angus with a=adults and c=calves.
Ancfc <- c(189,706,935,125,2)
Ancfa <- c(802,3415,15673,6314,481)
#Limousin with a=adults and c=calves.
Lmcfc <- c(735,1504,1419,72,0)
Lmcfa <- c(5102,21958,50705,7169,148)
#frequencies Carcass fat
#Angus with a=adults and c=calves.
Ancfc <- Ancfc/sum(Ancfc)
Ancfa <- Ancfa/sum(Ancfa)
#Limousin with a=adults and c=calves.
Lmcfc <- Lmcfc/sum(Lmcfc)
Lmcfa <- Lmcfa/sum(Lmcfa)

#Values Carcass fat classes
Vcf <- c(1:5)

#define number of rows
#x <- cbind(Vcf,Ancfc,Ancfa,Lmcfc,Lmcfa)
#colnames(x) <- c("class", "ANcalves", "ANadults", "LMcalves", "LMadults")
#kable(x, booktabs=T, caption="Population frequencies for each carcass fat class in Angus and Limousin calves and adults (Kunz, 2018)")
#x <- as.data.frame(x)
# settings barplot
library(ggplot2)
theme_set(theme_classic())
#set dataframe
x <-data.frame(Class=rep(c(1:5),times=2*2),Category=rep(c("Angus", "Limousin"),each=10), frequency=c(Ancfc,Ancfa,Lmcfc,Lmcfa))
x$Group <- rep(rep(c("Calves","Adults"),each=5),times=2)
# Plot
g <- ggplot(x,aes(Class,frequency))
g +facet_grid(~Group) + geom_bar(stat="identity", width=0.5, aes(fill=Category), position="dodge")+
  theme_classic()
```


```{r NormDistApprox, fig.cap="Exemplary approximation of a normal distribution to a discrete distribution.", echo=FALSE}
library(ggplot2)
AncfaS <- 0.74
AncfaM <- 3.1
x <- data.frame(Class=Vcf,frequency=Ancfa)
g <- ggplot(x,aes(Class,frequency))
g + geom_bar(stat="identity", width=0.5, fill="tomato2") +
  stat_function(fun = dnorm, args = list(mean = AncfaM, sd = AncfaS))+
  theme_classic()
```


```{r ShiftMean, fig.cap="Exemplary shift from initial to new distribution by increasing the mean of the initial normal distribution by 0.1", echo=FALSE}
library(ggplot2)
x <- data.frame(Class=Vcf,frequency=Ancfa)
g <- ggplot(x,aes(Class,frequency,linetype="Mean"))
g + stat_function(fun = dnorm, args = list(mean = AncfaM, sd = AncfaS), aes(linetype="Initial distribution"))+
  stat_function(fun = dnorm, args = list(mean = AncfaM+0.1, sd = AncfaS),aes(linetype="New distribution"))+
    scale_linetype_manual(values=c("solid","dashed"), guide = guide_legend(title=NULL))+
  theme_classic()
```


## Data Index

Distributions carcass fat.
```{r}
library(knitr)
library(dplyr)
library(tidyr)
library(readr)
library(ggplot2)
# Angus Adults
AN_CFa <- "~/Documents/EarlyMaturityBeef/EconomicWeights/Computation/computeindex/20181010_compute_index/nb/AN_CFa_freq.csv"
AN_CFa  <- read_csv2(file = AN_CFa)
colnames(AN_CFa) <- "Frequency"
AN_CFa$Breed <- c(rep("Angus",times=5))
AN_CFa$Group <- c(rep("Adults",times=5))
AN_CFa$Class <- c(1:5)
AN_CFa

# Angus Calves
AN_CFc <- "~/Documents/EarlyMaturityBeef/EconomicWeights/Computation/computeindex/20181010_compute_index/nb/AN_CFc_freq.csv"
AN_CFc  <- read_csv2(file = AN_CFc)
colnames(AN_CFc) <- "Frequency"
AN_CFc$Breed <- c(rep("Angus",times=5))
AN_CFc$Group <- c(rep("Calves",times=5))
AN_CFc$Class <- c(1:5)
AN_CFc

# Limousin Adults
LM_CFa <- "~/Documents/EarlyMaturityBeef/EconomicWeights/Computation/computeindex/20181010_compute_index/nb/LM_CFa_freq.csv"
LM_CFa  <- read_csv2(file = LM_CFa)
colnames(LM_CFa) <- "Frequency"
LM_CFa$Breed <- c(rep("Limousin",times=5))
LM_CFa$Group <- c(rep("Adults",times=5))
LM_CFa$Class <- c(1:5)
LM_CFa

# Limousin Calves
LM_CFc <- "~/Documents/EarlyMaturityBeef/EconomicWeights/Computation/computeindex/20181010_compute_index/nb/LM_CFc_freq.csv"
LM_CFc  <- read_csv2(file = LM_CFc)
colnames(LM_CFc) <- "Frequency"
LM_CFc$Breed <- c(rep("Limousin",times=5))
LM_CFc$Group <- c(rep("Calves",times=5))
LM_CFc$Class <- c(1:5)
LM_CFc

# Barplot
x <- rbind(AN_CFa,AN_CFc,LM_CFa,LM_CFc)
x
g <- ggplot(x,aes(Class,Frequency))
g + geom_bar(stat="identity",aes(fill=Group),position="dodge")+
  facet_grid(.~Breed)+
  theme_classic()+theme(text = element_text(size = 15))+
  ylab("Population frequency")+
  xlab("Carcass fat class")
```

Distributions carcass conformation
```{r}
library(knitr)
library(dplyr)
library(tidyr)
library(readr)
library(ggplot2)
# Angus Adults
AN_CCa <- "~/Documents/EarlyMaturityBeef/EconomicWeights/Computation/computeindex/20181010_compute_index/nb/AN_CCa_freq.csv"
AN_CCa  <- read_csv2(file = AN_CCa)
colnames(AN_CCa) <- "Frequency"
AN_CCa$Breed <- c(rep("Angus",times=7))
AN_CCa$Group <- c(rep("Adults",times=7))
AN_CCa$Class <- c("X","A","T-","T","T+","H","C")
AN_CCa

# Angus Calves
AN_CCc <- "~/Documents/EarlyMaturityBeef/EconomicWeights/Computation/computeindex/20181010_compute_index/nb/AN_CCc_freq.csv"
AN_CCc  <- read_csv2(file = AN_CCc)
colnames(AN_CCc) <- "Frequency"
AN_CCc$Breed <- c(rep("Angus",times=7))
AN_CCc$Group <- c(rep("Calves",times=7))
AN_CCc$Class <- c("X","A","T-","T","T+","H","C")
AN_CCc

# Limousin Adults
LM_CCa <- "~/Documents/EarlyMaturityBeef/EconomicWeights/Computation/computeindex/20181010_compute_index/nb/LM_CCa_freq.csv"
LM_CCa  <- read_csv2(file = LM_CCa)
colnames(LM_CCa) <- "Frequency"
LM_CCa$Breed <- c(rep("Limousin",times=7))
LM_CCa$Group <- c(rep("Adults",times=7))
LM_CCa$Class <- c("X","A","T-","T","T+","H","C")
LM_CCa

# Limousin Calves
LM_CCc <- "~/Documents/EarlyMaturityBeef/EconomicWeights/Computation/computeindex/20181010_compute_index/nb/LM_CCc_freq.csv"
LM_CCc  <- read_csv2(file = LM_CCc)
colnames(LM_CCc) <- "Frequency"
LM_CCc$Breed <- c(rep("Limousin",times=7))
LM_CCc$Group <- c(rep("Calves",times=7))
LM_CCc$Class <- c("X","A","T-","T","T+","H","C")
LM_CCc

# Barplot
x <- rbind(AN_CCa,AN_CCc,LM_CCa,LM_CCc)
x
g <- ggplot(x,aes(x=factor(Class,levels=c("X","A","T-","T","T+","H","C")),Frequency))
g + geom_bar(stat="identity",aes(fill=Group),position="dodge")+
  facet_grid(.~Breed)+
  theme_classic()+theme(text = element_text(size = 15))+
  ylab("Population frequency")+
  xlab("Carcass conformation class")
```

Mean and standard deviation carcass traits
```{r}
library(knitr)
library(dplyr)
library(tidyr)
library(readr)
library(ggplot2)
# Angus Adults
mean_sd <- "~/Documents/EarlyMaturityBeef/EconomicWeights/Computation/computeindex/20181010_compute_index/nb/mean_sd.csv"
mean_sd  <- read_csv2(file = mean_sd)
mean_sd <- as.matrix(mean_sd)
x <- data.frame(Breed=c("Angus","Angus","Limousin","Limousin"),Group=c("Adults","Calves","Adults","Calves"),Mean=as.numeric(c(mean_sd[11,3],mean_sd[12,3],mean_sd[5,3],mean_sd[6,3])),SD=as.numeric(c(mean_sd[11,4],mean_sd[12,4],mean_sd[5,4],mean_sd[6,4])))
x
kable(x,booktabs=T,caption="Mean and standard deviation in kg carcass weight")
```





